<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>Current Playlist</title>
		<link href="main.css" rel="stylesheet"/>
	</head>
	
	<body>
		<h1>Current Playlist</h1>
    <div class="toolbar">
      <div class="currentSongName"></div>
      <div class="skipSong"></div>
    </div>
    <hr/>
		<div id="plist">
			<ul id="ulist"></ul>
		</div>
		
	<script src="https://cdn.socket.io/socket.io-1.0.6.js"></script>
	<script src="http://code.jquery.com/jquery-1.11.1.js"></script>
	<script>
		var socket = io.connect("http://localhost:3000");
		var currentPlaylist = []; 
		
		socket.on('connect', function () {
			console.log("connected to server");
		});

    socket.emit("load_playlist",{});
		
		socket.on('load_playlist', function(obj) {
			currentPlaylist = obj;
			addWholePlToList();
		});

    socket.on('next_song', function(obj) {
      $(".currentSongName").html(obj.title);
    });

    $(".skipSong").click( function () {
      socket.emit("next_song",{});
    });

		function editedPlaylist() {
			socket.emit("update_playlist", currentPlaylist);
		}
		
		function addWholePlToList() {
			var parent = document.getElementById("plist");
			var ulist = document.getElementById("ulist");
			ulist.parentNode.removeChild(ulist);
			var newlist = document.createElement('ul');
			newlist.setAttribute("id","ulist");
			for(var i = 0; i < currentPlaylist.length; i++) {
				var songItem = document.createElement('li');
        songItem.innerHTML = currentPlaylist[i].title+ "   " + '<div class="buttons"><div class="up" onclick="moveItemUp(' + i + ')"></div>' + '<div class="down" onclick="moveItemDown(' + i + ')"></div>' + '<div class="remove" onclick="removeItem(' + i + ')"></div></div>';
				newlist.appendChild(songItem);
			}
			parent.appendChild(newlist);
			return;
		}
		
		function moveItemUp(i){
			if(i == 0) {
				return;
			}else{
				var tmp = currentPlaylist[i-1];
				currentPlaylist[i-1] = currentPlaylist[i];
				currentPlaylist[i] = tmp;
				addWholePlToList();
				editedPlaylist();
				return;
			}
		}
		
		function moveItemDown(i){
			if(i == currentPlaylist -1) {
				return;
			}else{
				var tmp = currentPlaylist[i+1];
				currentPlaylist[i+1] = currentPlaylist[i];
				currentPlaylist[i] = tmp;
				addWholePlToList();
				editedPlaylist();
				return;
			}
		}

		function removeItem(i){
			currentPlaylist.splice(i, 1);
			addWholePlToList();
			editedPlaylist();
			return;
		}
	
	</script>
	</body>
</html>

	
